#!/usr/bin/env es

# Open things I always use and send them to their designated tags

fn hc { herbstclient $* }

fn start_in tag rules a {
   clients=`{
      hc attr tags.by-name.$tag.client_count
   }
   if {[ $clients -ge 1 ]} {
      return
   }
   hc rule once maxage\=20 $rules tag\=$^tag
   nohup $a >/dev/null >[2=1] &
}

# delay starting ssh-dependent things until we have identities loaded
# if you use pam_ssh or something, this will never trigger. if you don't, it'll helpfully prompt
# for your passphrase at login
fork {
   if {[ `{ssh-add -l|wc -l} -lt 1 ]} {
	   ssh-add || exit
   }
   start_in 1 'instance=urxvt-irc' urxvt -name urxvt-irc -e mosh vimes -- tmux attach -t irc
}

start_in 2 'class=google-chrome' google-chrome --new-window
