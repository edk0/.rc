# vim: ft=es

EDITOR = vi
VISUAL = vi
PAGER = less

# find .esrc and resolve symlinks. the location of .es is relative to the
# directory it is in, so if .esrc is a symlink, .es does not also need to be
# symlinked.
if {! result $0} {
   # inside a `, $0 is '%backquote'
   local (me=$0) ESRC_DIR=`{dirname `{realpath $me}}
} {
   ESRC_DIR=.
}

# dependencies
. $ESRC_DIR/.es/alias.es
. $ESRC_DIR/.es/cdpath.es
. $ESRC_DIR/.es/cd_history.es

fn map f { let (s=) { while {!%count <={s = <=%read}} {$f <={%split <={%flatten '' $ifs} $s}} } }
fn filter f { map @{ if {$f $* >/dev/null} {echo $*} } }

cdpath = . ~ ~/src

fn command name args { local (fn-$name=) {$name $args} }

alias q    exit
alias hc   herbstclient
alias up   ssh upload
alias l    ls -CF --color\=auto
alias tt   tee /dev/tty

# these commands take commands as an argument; recursive-alias them to
# themselves so said argument gets expanded if it's an alias.
local (cmds = (
   command
   time
   stdbuf
   sudo
)) for (cmd=$cmds) { aliasr $cmd $cmd }

# 'env a\=b c\=d command` should expand command as an alias.
%makealias env <={
   %alias_expands \
      @ x{~ $x -* *\=*} \
      0 \
      env
}

fn %prompt {
   fn %prompt
   . $ESRC_DIR/.es/session.es
   if {! result $fn-%prompt} %prompt
}

true
